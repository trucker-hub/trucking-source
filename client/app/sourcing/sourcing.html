<br>
<div class="container">
  <div class="panel panel-default">

    <div class="panel-heading">
      <span>Loads:</span>
      <button type="button" class="btn btn-default btn-link" ng-click="queryLoads(1)">Today's</button>
      <button type="button" class="btn btn-warning btn-link" ng-click="queryLoads(3)">Last 3 days </button>
      <button type="button" class="btn btn-warning btn-link" ng-click="queryLoads(7)">Last week</button>
      <button type="button" class="btn btn-danger btn-link" ng-click="queryLoads(-1)">All</button>

    </div>
    <div class="panel-body">
      <table ng-table="tableParamsLoads" show-filter="true" class="table table-responsive table-hover table-condensed">

        <tr ng-repeat="load in $data" ng-click="selectLoad(load)" ng-class="{'success':load==selectedLoad}">
          <td data-title="'Type'"><load-type type="load.loadType"></load-type></td>
          <td data-title="'Shipper'" filter="{ 'who': 'text' }">
            {{load.who}}
          </td>
          <td data-title="'Delivery'">
            {{load.shipFrom.location | location: true}} <span class="glyphicon glyphicon-arrow-right" aria-hidden="true"></span> {{load.shipTo.location | location: true}}
          </td>
          <td data-title="'By'">
            {{load.expectedBy | date:'shortDate'}}
          </td>
          <td data-title="'Trucker'">
            {{load.fulfilledBy.name}}
          </td>
          <td data-title="'Cost'">
            <b>{{load.totalAmount | currency:"$":2}}</b> {{load.vendorChargeAmount | currency:"$":2}}
          </td>
          <td data-title="'Sourcing'">
            <div ng-show="selectedLoad==load"><a ng-click="sourcing()"><i  class="fa fa-search-plus fa-lg"></i></a></div>
            <div ng-show="selectedLoad==load && load.loadType!='FTL'"><a ng-click="upsLoad(selectedLoad)"><i class="fa fa-hand-o-down fa-lg"></i></a></div>

          </td>
        </tr>
      </table>
    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">Choices <span class="badge">{{selectedLoad.sources.length}}</span> </div>
    <div class="panel-body">
      <table class="table table-hover">
        <tr>
          <th></th>
          <th>Company</th>
          <th>Trucking Cost</th>
          <th>Time</th>
          <th>Contact</th>
          <th>Location</th>
          <th></th>
        </tr>
        <tr ng-repeat-start="source in selectedLoad.sources" ng-class="{'success':source.id==selectedLoad.fulfilledBy.source}" >
          <th>
            <i class="fa" ng-class="{'fa-check':source.id==selectedLoad.fulfilledBy.source, 'fa-lock': (selectedLoad.status=='FILLED' && source.id==selectedLoad.fulfilledBy.source)}"></i>
          </th>
          <th >{{source.name}}</th>
          <td ><b>{{source.totalCost | currency:"$":2}}</b>
              <i ng-click="toggleSourceDetails(source)" class="fa fa-lg"
                 ng-class="{'fa-plus-square-o':!source.showDetails, 'fa-minus-square-o':source.showDetails}"></i>
          </td>
          <td >{{source.time}}</td>
          <td >{{source.contact | tel }}</td>
          <td >{{source.location}}</td>
          <td>
            <button type="button" class="btn btn-default" ng-click="selectSource(source)" ng-disabled="source.id==selectedLoad.fulfilledBy.source">
              <span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Select
            </button>
          </td>
        </tr>
        <tr ng-repeat-end>
          <td colspan="7">
            <table class="table table-bordered" ng-show="source.showDetails">
              <tr>
                <th>Cost Items</th>
                <th>Vendor Cost Description</th>
                <th>Broker Adjustments</th>
                <th>Adjusted Costs</th>
              </tr>
              <tr ng-repeat="entry in source.costItems track by $index">
                <td align="right">#{{$index+1}}</td>
                <td><b>{{entry.charge | currency:"$":2}}</b> for {{entry.description}}</td>
                <td> <div class="input-group">
                  <div class="input-group-addon">$</div>
                  <input type="number" class="form-control" size="5" ng-model="entry.adjustment" placeholder="00.00" ng-change="recalcAdjustments()"></div>
                </td>
                <td>{{entry.charge + entry.adjustment | currency:"$":2}}</td>
              </tr>
              <tr>
                <td colspan="3" align="right"><b>Total Trucking Cost:</b></td><td>{{selectedLoad.vendorChargeAmount | currency:"$":2}}</td>
              </tr>
              <tr>
                <th></th>
                <th colspan="2">Broker Fees</th>
                <td></td>
              </tr>
              <tr ng-repeat="entry in selectedLoad.brokerFees">
                <td align="right">{{entry.name}}</td>
                <td colspan="2">
                  <div class="input-group">
                    <div class="input-group-addon">$</div>
                    <input type="number" class="form-control" size="5" ng-model="entry.charge" placeholder="00.00" ng-change="recalcAdjustments()">
                </div>
                </td>
                <td></td>
              </tr>
              <tr>
                <td colspan="3" align="right"><b>Total Charge</b></td>
                <td colspan="1">{{selectedLoad.totalAmount | currency:"$":2}}
                </td>
              </tr>
              <tr ng-show="source.id==selectedLoad.fulfilledBy.source">
                <td align="right"><button type="button" ng-disabled="selectedLoad.status=='FILLED'" class="btn btn-primary" ng-click="finalizeSource()">
                  <span class="glyphicon glyphicon-ok" aria-hidden="true" ></span> Finalize</button>
                </td>
                <td colspan="3">
                  <div ng-show="selectedLoad.status=='FILLED'">
                    <button type="button" class="btn btn-default" ng-click="createInvoice()"><i class="fa fa-list-alt"></i> Review Invoice</button>
                    <button type="button" class="btn btn-default" ng-click="createDO()"><i class="fa fa-paper-plane-o"></i> Review DO</button>
                  </div>
                </td>
              </tr>
            </table>
          </td>
        </tr>
      </table>
    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading form-group"><b>Detail Load Information:</b> {{selectedLoad.who}}
        <i ng-click="toggleLoadDetails(selectedLoad)" class="fa fa-lg"
           ng-class="{'fa-plus-square-o':!selectedLoad.showLoadDetails, 'fa-minus-square-o':selectedLoad.showLoadDetails}"></i>
    </div>
    <div class="panel-body" ng-show="selectedLoad.showLoadDetails">
      <load-details load="selectedLoad"></load-details>
    </div>
  </div>


</div>














