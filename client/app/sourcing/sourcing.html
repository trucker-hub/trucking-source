<div ng-include="'components/navbar/navbar.html'"></div>

<br>
<div class="container">
  <div class="panel panel-default">

    <div class="panel-heading">
      <button type="button" class="btn btn-default btn-link" ng-click="queryLoads('OPEN',1)">Today Loads</button>
      <button type="button" class="btn btn-warning btn-link" ng-click="queryLoads('OPEN',3)">Open for 3 days </button>
      <button type="button" class="btn btn-warning btn-link" ng-click="queryLoads('OPEN',7)">Open for 1 week</button>
      <button type="button" class="btn btn-danger btn-link" ng-click="queryLoads('OPEN',14)">All Open Loads</button>

    </div>
    <div class="panel-body">
      <table ng-table="tableParamsLoads" show-filter="true" class="table table-responsive table-hover table-condensed">

        <tr ng-repeat="load in $data" ng-click="select(load)" ng-class="{'success':load==selectedLoad}">
          <td data-title="'Type'"><load-type type="load.loadType"></load-type></td>
          <td data-title="'Shipper'" filter="{ 'who': 'text' }">
            {{load.who}}
          </td>
          <td data-title="'Delivery'">
            {{load.shipFrom.location | location: true}} <span class="glyphicon glyphicon-arrow-right" aria-hidden="true"></span> {{load.shipTo.location | location: true}}
          </td>
          <td data-title="'Delivery By'">
            {{load.expectedBy | date:'shortDate'}}
          </td>
          <td data-title="'Selected Trucker'">
            {{load.fulfilledBy.name}}
          </td>
          <td data-title="'Base Charge'">
            {{load.fulfilledBy.charge | currency:"$":2}}
          </td>
          <td data-title="'Sourcing'">
            <div ng-show="selectedLoad==load"><a ng-click="sourcing()"><i  class="fa fa-search fa-lg"></i></a> </div>
          </td>
        </tr>
      </table>
    </div>
  </div>

  <div class="panel panel-info">
    <div class="panel-heading">Trucking Company Choices</div>
    <div class="panel-body">
      <table class="table table-hover">
        <tr>
          <th></th>
          <th>Company</th>
          <th>Cost</th>
          <th>Time</th>
          <th>Contact</th>
          <th>Location</th>
          <th></th>
        </tr>
        <tr ng-repeat-start="source in selectedLoad.sources" ng-class="{'success':source.id==selectedLoad.fulfilledBy.source}" >
          <th><span ng-show="source.id==selectedLoad.fulfilledBy.source" class="glyphicon glyphicon-ok" aria-hidden="true"></span></th>
          <th >{{source.name}}</th>
          <td ><b>{{source.totalCost | currency:"$":2}}</b></td>
          <td >{{source.time}}</td>
          <td >{{source.contact | tel }}</td>
          <td >{{source.location}}</td>
          <td>
            <button type="button" class="btn btn-default" ng-click="selectSource(source)">
              <span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Select
            </button>
          </td>
        </tr>
        <tr ng-repeat-end>
          <td></td>
          <td colspan="6">
            <table class="table table-bordered" ng-show="source.id==selectedLoad.fulfilledBy.source">
              <tr>
                <th>Vendor Cost Items</th>
                <th>Broker Adjustments</th>
              </tr>
              <tr ng-repeat="entry in source.costItems">
                <td><b>{{entry.charge | currency:"$":2}}</b> for {{entry.description}}</td>
                <td> <div class="input-group">
                  <div class="input-group-addon">$</div>
                  <input type="number" class="form-control" size="5" ng-model="entry.adjustment" placeholder="00.00" ng-change="recalcAdjustments()"></div></td>
              </tr>
              <tr>
                <th></th>
                <th>Broker Fees</th>
              </tr>
              <tr ng-repeat="entry in selectedLoad.brokerFees">
                <td align="right">{{entry.name}}</td>
                <td>
                  <div class="input-group">
                    <div class="input-group-addon">$</div>
                    <input type="number" class="form-control" size="5" ng-model="entry.charge" placeholder="00.00" ng-change="recalcAdjustments()">
                </div>
                </td>
              </tr>
              <tr>
                <td align="right"><b>Total Adjustment</b></td>
                <td>{{selectedLoad.adjustmentAmount | currency:"$":2}}

                </td>
              </tr>
              <tr>
                <td align="right"><button type="button" ng-disabled="selectedLoad.status=='FILLED'" class="btn btn-default" ng-click="finalizeSource()">
                  <span class="glyphicon glyphicon-ok" aria-hidden="true" ></span> Finalize</button>
                </td>
                <td>
                  <div ng-show="selectedLoad.status=='FILLED'">
                    <button type="button" class="btn btn-default" ng-click="createInvoice()"><i class="fa fa-list-alt"></i> Invoice</button>
                    <button type="button" class="btn btn-default" ng-click="createDO()"><i class="fa fa-paper-plane-o"></i> DO</button>
                  </div>

                </td>
              </tr>
            </table>
          </td>
        </tr>
      </table>
    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading form-group"><b>Detail Load Information:</b> {{selectedLoad.who}}</div>
    <div class="panel-body">
      <load-details load="selectedLoad"></load-details>
    </div>
  </div>


</div>














